{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport firebase from \"firebase\";\nimport \"firebase/firestore\";\nexport function GetUser() {\n  var currentUser, db, docRef, result;\n  return _regeneratorRuntime.async(function GetUser$(_context) {\n    while (1) {\n      switch (_context.prev = _context.next) {\n        case 0:\n          _context.prev = 0;\n          currentUser = firebase.auth().currentUser;\n          db = firebase.firestore();\n          docRef = db.collection(\"users\").doc(currentUser.uid);\n          _context.next = 6;\n          return _regeneratorRuntime.awrap(docRef.get());\n\n        case 6:\n          result = _context.sent;\n          return _context.abrupt(\"return\", result.data());\n\n        case 10:\n          _context.prev = 10;\n          _context.t0 = _context[\"catch\"](0);\n          console.log(_context.t0.message);\n          return _context.abrupt(\"return\", undefined);\n\n        case 14:\n        case \"end\":\n          return _context.stop();\n      }\n    }\n  }, null, null, [[0, 10]], Promise);\n}\nexport function updateUser(user) {\n  var currentUser, db;\n  return _regeneratorRuntime.async(function updateUser$(_context2) {\n    while (1) {\n      switch (_context2.prev = _context2.next) {\n        case 0:\n          _context2.prev = 0;\n          currentUser = firebase.auth().currentUser;\n          db = firebase.firestore();\n          _context2.next = 5;\n          return _regeneratorRuntime.awrap(db.collection(\"users\").doc(currentUser.uid).update(user));\n\n        case 5:\n          return _context2.abrupt(\"return\", true);\n\n        case 8:\n          _context2.prev = 8;\n          _context2.t0 = _context2[\"catch\"](0);\n          console.log(_context2.t0.message);\n          return _context2.abrupt(\"return\", false);\n\n        case 12:\n        case \"end\":\n          return _context2.stop();\n      }\n    }\n  }, null, null, [[0, 8]], Promise);\n}\nexport function updateEmail(email, password, newEmail) {\n  var result, res, user, currentUser;\n  return _regeneratorRuntime.async(function updateEmail$(_context3) {\n    while (1) {\n      switch (_context3.prev = _context3.next) {\n        case 0:\n          console.log(email + \" \" + password);\n          result = false;\n          _context3.next = 4;\n          return _regeneratorRuntime.awrap(signIn(email, password));\n\n        case 4:\n          res = _context3.sent;\n\n          if (!res) {\n            _context3.next = 13;\n            break;\n          }\n\n          _context3.next = 8;\n          return _regeneratorRuntime.awrap(GetUser());\n\n        case 8:\n          user = _context3.sent;\n          user.email = newEmail;\n          updateUser(user);\n          currentUser = firebase.auth().currentUser;\n          result = new Promise(function (resolve, reject) {\n            currentUser.updateEmail(newEmail).then(function () {\n              resolve(true);\n            }).catch(function (error) {\n              console.log(error);\n              reject(error.message);\n            });\n          });\n\n        case 13:\n          return _context3.abrupt(\"return\", result);\n\n        case 14:\n        case \"end\":\n          return _context3.stop();\n      }\n    }\n  }, null, null, null, Promise);\n}\nexport function updatePassword(email, password, newPassword) {\n  var result, res, currentUser;\n  return _regeneratorRuntime.async(function updatePassword$(_context4) {\n    while (1) {\n      switch (_context4.prev = _context4.next) {\n        case 0:\n          result = false;\n          _context4.next = 3;\n          return _regeneratorRuntime.awrap(signIn(email, password));\n\n        case 3:\n          res = _context4.sent;\n\n          if (res) {\n            currentUser = firebase.auth().currentUser;\n            result = new Promise(function (resolve, reject) {\n              currentUser.updatePassword(newPassword).then(function () {\n                resolve(true);\n              }).catch(function (error) {\n                console.log(error);\n                reject(error.message);\n              });\n            });\n          }\n\n          return _context4.abrupt(\"return\", result);\n\n        case 6:\n        case \"end\":\n          return _context4.stop();\n      }\n    }\n  }, null, null, null, Promise);\n}\nexport function signIn(email, password) {\n  var result;\n  return _regeneratorRuntime.async(function signIn$(_context5) {\n    while (1) {\n      switch (_context5.prev = _context5.next) {\n        case 0:\n          result = {};\n          result = new Promise(function (resolve, reject) {\n            firebase.auth().signInWithEmailAndPassword(email, password).then(function (userCredential) {\n              resolve(true);\n            }).catch(function (error) {\n              console.log(error);\n              reject(error.message);\n            });\n          });\n          return _context5.abrupt(\"return\", result);\n\n        case 3:\n        case \"end\":\n          return _context5.stop();\n      }\n    }\n  }, null, null, null, Promise);\n}\nexport function uploadImage(uri, ext) {\n  var result, metadata, currentUser, uploadTask;\n  return _regeneratorRuntime.async(function uploadImage$(_context6) {\n    while (1) {\n      switch (_context6.prev = _context6.next) {\n        case 0:\n          result = {};\n          metadata = {\n            contentType: 'image/jpeg'\n          };\n          console.log(uri);\n\n          try {\n            currentUser = firebase.auth().currentUser;\n            uploadTask = firebase.storage().ref('avatar/' + currentUser.uid + '.' + ext).putString(uri, 'base64', {\n              contentType: 'image/jpg'\n            });\n            uploadTask.on('state_changed', function (snapshot) {\n              var progress = snapshot.bytesTransferred / snapshot.totalBytes * 100;\n              console.log('Upload is ' + progress + '% done');\n\n              switch (snapshot.state) {\n                case firebase.storage.TaskState.PAUSED:\n                  console.log('Upload is paused');\n                  break;\n\n                case firebase.storage.TaskState.RUNNING:\n                  console.log('Upload is running');\n                  break;\n              }\n            }, function (error) {\n              console.log(error);\n            }, function () {\n              uploadTask.snapshot.ref.getDownloadURL().then(function (downloadURL) {\n                console.log('File available at', downloadURL);\n              });\n            });\n          } catch (error) {\n            console.log(error);\n          }\n\n          return _context6.abrupt(\"return\", result);\n\n        case 5:\n        case \"end\":\n          return _context6.stop();\n      }\n    }\n  }, null, null, null, Promise);\n}\nexport function signOut() {\n  return _regeneratorRuntime.async(function signOut$(_context7) {\n    while (1) {\n      switch (_context7.prev = _context7.next) {\n        case 0:\n          firebase.auth().signOut();\n\n        case 1:\n        case \"end\":\n          return _context7.stop();\n      }\n    }\n  }, null, null, null, Promise);\n}","map":{"version":3,"sources":["D:/Utilisateurs/Armand/Documents/Ynov/WebMobilePWA/Best-Movie/src/screens/utils/GetDataUser.js"],"names":["firebase","GetUser","currentUser","auth","db","firestore","docRef","collection","doc","uid","get","result","data","console","log","message","undefined","updateUser","user","update","updateEmail","email","password","newEmail","signIn","res","Promise","resolve","reject","then","catch","error","updatePassword","newPassword","signInWithEmailAndPassword","userCredential","uploadImage","uri","ext","metadata","contentType","uploadTask","storage","ref","putString","on","snapshot","progress","bytesTransferred","totalBytes","state","TaskState","PAUSED","RUNNING","getDownloadURL","downloadURL","signOut"],"mappings":"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","sourcesContent":["import firebase from \"firebase\";\r\nimport \"firebase/firestore\";\r\n\r\nexport async function GetUser() {\r\n  try {\r\n    const currentUser = firebase.auth().currentUser;\r\n    const db = firebase.firestore();\r\n\r\n    var docRef = db.collection(\"users\").doc(currentUser.uid);\r\n    const result = await docRef.get();\r\n    return result.data();\r\n  } catch (err) {\r\n    console.log(err.message);\r\n    return undefined;\r\n  }\r\n}\r\n\r\nexport async function updateUser(user) {\r\n  try {\r\n    const currentUser = firebase.auth().currentUser;\r\n    const db = firebase.firestore();\r\n\r\n    await db.collection(\"users\").doc(currentUser.uid).update(user);\r\n    return true;\r\n  } catch (err) {\r\n    console.log(err.message);\r\n    return false;\r\n  }\r\n}\r\n\r\nexport async function updateEmail(email, password, newEmail) {\r\n  console.log(email + \" \" + password);\r\n  let result = false;\r\n\r\n  let res = await signIn(email, password);\r\n  if (res) {\r\n    let user = await GetUser();\r\n    user.email = newEmail;\r\n    updateUser(user);\r\n    const currentUser = firebase.auth().currentUser;\r\n    result = new Promise((resolve, reject) => {\r\n      currentUser.updateEmail(newEmail).then(() => {\r\n        resolve(true);\r\n      }).catch((error) => {\r\n        console.log(error);\r\n        reject(error.message);\r\n      })\r\n    });\r\n  }\r\n\r\n  return result;\r\n}\r\n\r\nexport async function updatePassword(email, password, newPassword) {\r\n  let result = false;\r\n\r\n  let res = await signIn(email, password);\r\n  if (res) {\r\n    const currentUser = firebase.auth().currentUser;\r\n    result = new Promise((resolve, reject) => {\r\n      currentUser.updatePassword(newPassword).then(() => {\r\n        resolve(true);\r\n      }).catch((error) => {\r\n        console.log(error);\r\n        reject(error.message);\r\n      })\r\n    });\r\n  }\r\n\r\n  return result;\r\n}\r\n\r\nexport async function signIn(email, password) {\r\n  let result = {};\r\n  result = new Promise((resolve, reject) => {\r\n    firebase.auth().signInWithEmailAndPassword(email, password)\r\n      .then((userCredential) => {\r\n        resolve(true);\r\n      })\r\n      .catch((error) => {\r\n        console.log(error);\r\n        reject(error.message);\r\n      });\r\n  });\r\n\r\n  return result;\r\n}\r\n\r\nexport async function uploadImage(uri, ext) {\r\n  let result = {};\r\n  // Create a root reference\r\n  var metadata = {\r\n    contentType: 'image/jpeg',\r\n  };\r\n  console.log(uri);\r\n\r\n\r\n  try {\r\n    const currentUser = firebase.auth().currentUser;\r\n\r\n    var uploadTask = firebase.storage().ref('avatar/' + currentUser.uid + '.' + ext).putString(uri, 'base64', { contentType: 'image/jpg' });\r\n\r\n    uploadTask.on('state_changed',\r\n      (snapshot) => {\r\n        // Observe state change events such as progress, pause, and resume\r\n        // Get task progress, including the number of bytes uploaded and the total number of bytes to be uploaded\r\n        var progress = (snapshot.bytesTransferred / snapshot.totalBytes) * 100;\r\n        console.log('Upload is ' + progress + '% done');\r\n        switch (snapshot.state) {\r\n          case firebase.storage.TaskState.PAUSED: // or 'paused'\r\n            console.log('Upload is paused');\r\n            break;\r\n          case firebase.storage.TaskState.RUNNING: // or 'running'\r\n            console.log('Upload is running');\r\n            break;\r\n        }\r\n      },\r\n      (error) => {\r\n        // Handle unsuccessful uploads\r\n        console.log(error);\r\n      },\r\n      () => {\r\n        // Handle successful uploads on complete\r\n        // For instance, get the download URL: https://firebasestorage.googleapis.com/...\r\n        uploadTask.snapshot.ref.getDownloadURL().then((downloadURL) => {\r\n          console.log('File available at', downloadURL);\r\n        });\r\n      }\r\n    );\r\n  } catch (error) {\r\n    console.log(error);\r\n  }\r\n\r\n  return result;\r\n}\r\n\r\nexport async function signOut() {\r\n  firebase.auth().signOut();\r\n}"]},"metadata":{},"sourceType":"module"}